psql -h localhost -p 5432 -U postgres

docker run --name posttest -d -p 5432:5432 -e POSTGRES_PASSWORD=mysecretpassword postgres

export DATABASE_URL="postgresql://postgres:mysecretpassword@localhost/dblog"

CREATE DATABASE dblog;

# best example: https://citizen428.net/blog/asynchronous-notifications-in-postgres/

docker-compose up --build

works:


CREATE TABLE orders (
  id SERIAL PRIMARY KEY,
  email TEXT NOT NULL,
  total BIGINT NOT NULL
);


# function:

CREATE OR REPLACE FUNCTION PUBLIC.NOTIFY() RETURNS trigger AS
$BODY$
BEGIN
  PERFORM pg_notify('events', row_to_json(NEW)::text);
  RETURN new;
END;
$BODY$
LANGUAGE 'plpgsql' VOLATILE COST 100;


# create trigger:

CREATE TRIGGER notify_order_event
AFTER INSERT OR UPDATE OR DELETE ON orders
  FOR EACH ROW EXECUTE PROCEDURE notify_event();



# add notify
select pg_notify('events', 'user1 added');



# python3
sudo apt install python3-pip
sudo apt-get install python3-psycopg2


# migrations:

python manage.py db init
python manage.py db migrate
python manage.py db upgrade

python manage.py runserver


psql -h localhost -U postgres -d docker

insert into users (name) values ('hello');
DELETE FROM users where users.id = 12;

UPDATE users
SET name = 'John'
WHERE
   users.id = 31;


notified! got: {"id":58,"name":"hello2"}



docker=# insert into users (name) values ('hello');
INSERT 0 1
Asynchronous notification "events" with payload "{"operation" : "INSERT", "record" : {"id":13,"name":"hello"}}" received from server process with PID 83.





GET	http://[hostname]/todo/api/v1.0/tasks	Retrieve list of tasks
GET	http://[hostname]/todo/api/v1.0/tasks/[task_id]	Retrieve a task
POST	http://[hostname]/todo/api/v1.0/tasks	Create a new task
PUT	http://[hostname]/todo/api/v1.0/tasks/[task_id]	Update an existing task
DELETE	http://[hostname]/todo/api/v1.0/tasks/[task_id]	Delete a task



{
  "operation" : "INSERT",
   "record" : {
     "id":13,
     "name":"hello"
   }
}